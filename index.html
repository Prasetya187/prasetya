<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Robot Si Tukang Jalan - Phaser (10 Level)</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; background: #e0f7fa; margin: 0; }
    #controls {
      padding: 10px;
    }
    .command {
      display: inline-block;
      padding: 8px 12px;
      background: #0277bd;
      color: white;
      margin: 5px;
      border-radius: 5px;
      cursor: grab;
      user-select: none;
    }
    #commandList {
      margin-top: 10px;
      min-height: 30px;
    }
    button {
      padding: 10px 16px;
      margin: 5px;
      font-size: 16px;
    }
    #dropZone {
      min-height: 40px;
      border: 2px dashed #aaa;
      padding: 10px;
      background-color: #f5f5f5; /* Sedikit perubahan warna untuk drop zone */
    }
  </style>
</head>
<body>

<h1>Robot Si Tukang Jalan</h1>
<h2>Level <span id="level">1</span> dari <span id="maxLevelDisplay">10</span></h2>

<div id="controls">
  <div>
    <div class="command" draggable="true" ondragstart="drag(event)" data-cmd="forward">Maju</div>
    <div class="command" draggable="true" ondragstart="drag(event)" data-cmd="left">Kiri</div>
    <div class="command" draggable="true" ondragstart="drag(event)" data-cmd="right">Kanan</div>
  </div>
  <div style="margin-top: 10px;">
    <div id="dropZone"
          ondrop="drop(event)"
          ondragover="allowDrop(event)">
      <strong>Seret perintah ke sini</strong>
    </div>
    <div id="commandList"></div>
    <button onclick="runCommands()">Jalankan</button>
    <button onclick="resetCommands()">Ulangi Perintah</button>
  </div>
</div>

<script>
let config = {
  type: Phaser.AUTO,
  width: 400,
  height: 400,
  parent: document.body,
  backgroundColor: '#ffffff',
  scene: {
    preload: preload,
    create: create,
    update: update
  }
};

let game = new Phaser.Game(config);

// Game state
let level = 1;
let maxLevel = 10; // Diperbarui menjadi 10
let gridSize = 5;
let cellSize = 80;
let robot, goal, stones = [], commands = [], running = false;
let robotDir = 0; // 0 up, 1 right, 2 down, 3 left
let robotPos = { x: 0, y: 0 };
let sceneRef;

const levels = [
  [], // Index 0 (tidak digunakan, dimulai dari level 1)
  [{x:2, y:2}], // Level 1
  [{x:1, y:1},{x:3,y:2}], // Level 2
  [{x:1, y:0},{x:2,y:1},{x:3,y:3}], // Level 3
  [{x:0,y:3},{x:2,y:2},{x:3,y:1},{x:4,y:0}], // Level 4
  [{x:1,y:1},{x:1,y:2},{x:2,y:3},{x:3,y:2},{x:4,y:1}], // Level 5
  
  // --- Level Baru Ditambahkan di sini ---
  [{x:0,y:1},{x:1,y:1},{x:1,y:3},{x:2,y:1},{x:3,y:3}], // Level 6: Rintangan membentuk "S" terbalik
  [{x:1,y:0},{x:1,y:2},{x:2,y:2},{x:3,y:0},{x:3,y:2},{x:4,y:2}], // Level 7: Rintangan di tengah
  [{x:0,y:2},{x:1,y:2},{x:2,y:0},{x:2,y:1},{x:2,y:3},{x:3,y:2},{x:4,y:2}], // Level 8: Rintangan di tengah membentuk jalur sempit
  [{x:0,y:1},{x:0,y:3},{x:1,y:1},{x:1,y:3},{x:2,y:2},{x:3,y:1},{x:3,y:3},{x:4,y:1},{x:4,y:3}], // Level 9: Rintangan di setiap baris/kolom
  [{x:0,y:2},{x:1,y:0},{x:1,y:4},{x:2,y:1},{x:2,y:3},{x:3,y:0},{x:3,y:4},{x:4,y:2}] // Level 10: Rintangan diagonal dan di tengah
];

function preload() {
  this.load.image('robot', 'https://cdn-icons-png.flaticon.com/512/4712/4712107.png');
  this.load.image('goal', 'https://cdn-icons-png.flaticon.com/512/616/616408.png');
  this.load.image('stone', 'https://cdn-icons-png.flaticon.com/512/685/685655.png');
}

function create() {
  sceneRef = this;
  drawGrid(this);
  setupLevel(this, level);
  document.getElementById('maxLevelDisplay').textContent = maxLevel; // Perbarui tampilan maxLevel
}

function drawGrid(scene) {
  for (let i = 0; i < gridSize; i++) {
    for (let j = 0; j < gridSize; j++) {
      let graphics = scene.add.graphics();
      graphics.lineStyle(1, 0xcccccc);
      graphics.strokeRect(j * cellSize, i * cellSize, cellSize, cellSize);
    }
  }
}

function setupLevel(scene, lvl) {
  robotPos = { x: 0, y: 0 };
  robotDir = 0;
  commands = [];
  document.getElementById('commandList').textContent = '';
  document.getElementById('dropZone').innerHTML = "<strong>Seret perintah ke sini</strong>";

  if (robot) robot.destroy();
  if (goal) goal.destroy();
  stones.forEach(s => s.destroy());
  stones = [];

  // Goal selalu di sudut kanan bawah (4,4)
  goal = scene.add.image(4 * cellSize + 40, 4 * cellSize + 40, 'goal').setScale(0.08);
  robot = scene.add.image(robotPos.x * cellSize + 40, robotPos.y * cellSize + 40, 'robot').setScale(0.08);
  robot.setRotation(0); // Pastikan robot menghadap ke atas

  // Tambahkan batu berdasarkan level saat ini
  if (levels[lvl]) { // Pastikan level ada
    levels[lvl].forEach(pos => {
      let stone = scene.add.image(pos.x * cellSize + 40, pos.y * cellSize + 40, 'stone').setScale(0.08);
      stones.push(stone);
    });
  }

  document.getElementById('level').textContent = lvl;
}

function update() {}

function runCommands() {
  if (running || commands.length === 0) return;
  running = true;
  let i = 0;
  function step() {
    if (i < commands.length) {
      executeCommand(commands[i]);
      i++;
      setTimeout(step, 500);
    } else {
      running = false;
      checkWin();
    }
  }
  step();
}

function executeCommand(cmd) {
  if (cmd === 'left') {
    robotDir = (robotDir + 3) % 4;
    robot.setRotation(robotDir * Math.PI / 2); // Putar robot secara visual
  } else if (cmd === 'right') {
    robotDir = (robotDir + 1) % 4;
    robot.setRotation(robotDir * Math.PI / 2); // Putar robot secara visual
  } else if (cmd === 'forward') {
    let dx = [0,1,0,-1][robotDir];
    let dy = [-1,0,1,0][robotDir];
    let nx = robotPos.x + dx;
    let ny = robotPos.y + dy;

    // Periksa tabrakan dengan batu
    let hitStone = levels[level].some(p => p.x === nx && p.y === ny);

    if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize && !hitStone) {
      robotPos.x = nx;
      robotPos.y = ny;
      robot.x = nx * cellSize + 40;
      robot.y = ny * cellSize + 40;
    } else {
      // Jika menabrak dinding atau batu, reset level
      alert('⚠️ Robot menabrak dinding atau batu! Coba lagi.');
      running = false; // Hentikan eksekusi perintah
      setupLevel(sceneRef, level); // Reset level
      return; // Hentikan fungsi
    }
  }
}

function checkWin() {
  if (robotPos.x === 4 && robotPos.y === 4) {
    if (level < maxLevel) {
      alert('🎉 Level selesai! Lanjut ke level berikutnya!');
      level++;
      setupLevel(sceneRef, level);
    } else {
      alert('🏆 Hebat! Kamu menyelesaikan semua level!');
      level = 1; // Kembali ke level 1 setelah selesai semua
      setupLevel(sceneRef, level);
    }
  } else {
    alert('😅 Belum sampai tujuan. Coba lagi ya!');
    setupLevel(sceneRef, level); // Reset level jika gagal mencapai tujuan
  }
}

function resetCommands() {
  commands = [];
  document.getElementById('commandList').textContent = '';
  document.getElementById('dropZone').innerHTML = "<strong>Seret perintah ke sini</strong>";
  setupLevel(sceneRef, level); // Reset posisi robot juga
}

// Drag and Drop Functions
function allowDrop(ev) {
  ev.preventDefault();
}

function drag(ev) {
  ev.dataTransfer.setData("text", ev.target.dataset.cmd);
}

function drop(ev) {
  ev.preventDefault();
  let cmd = ev.dataTransfer.getData("text");
  commands.push(cmd);
  let span = document.createElement('span');
  span.textContent = cmd;
  span.style.margin = "0 5px";
  span.style.background = "#0277bd"; /* Warna latar belakang perintah */
  span.style.color = "white"; /* Warna teks perintah */
  span.style.padding = "5px 8px";
  span.style.borderRadius = "3px";
  document.getElementById("dropZone").appendChild(span);
  document.getElementById("commandList").textContent = ""; // Kosongkan ini agar tidak ada duplikasi
}
</script>

</body>
</html>